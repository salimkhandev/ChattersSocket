<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Minimal WebRTC Demo</title>
</head>

<body>
  <h2>Minimal WebRTC Video Demo</h2>

  <video id="localVideo" autoplay playsinline muted style="width: 45%; border: 1px solid black;"></video>
  <video id="remoteVideo" autoplay playsinline style="width: 45%; border: 1px solid black;"></video>

  <div>
    <button id="start">Start Camera</button>
    <button id="createOffer">Create Offer</button>
    <button id="createAnswer">Create Answer</button>
  </div>

  <textarea id="sdp" placeholder="SDP Offer/Answer here" rows="10" cols="70"></textarea>

  <script>
    let localStream;
    let pc;
    const servers = null; // No STUN/TURN servers here for simplicity

    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');
    const sdpTextarea = document.getElementById('sdp');

    document.getElementById('start').onclick = async () => {
      localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      localVideo.srcObject = localStream;
    };

    document.getElementById('createOffer').onclick = async () => {
      pc = new RTCPeerConnection(servers);
      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

      pc.ontrack = e => {
        if (remoteVideo.srcObject !== e.streams[0]) {
          remoteVideo.srcObject = e.streams[0];
        }
      };

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);

      sdpTextarea.value = JSON.stringify(pc.localDescription);
    };

    document.getElementById('createAnswer').onclick = async () => {
      pc = new RTCPeerConnection(servers);
      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));

      pc.ontrack = e => {
        if (remoteVideo.srcObject !== e.streams[0]) {
          remoteVideo.srcObject = e.streams[0];
        }
      };

      const offerDesc = JSON.parse(sdpTextarea.value);
      await pc.setRemoteDescription(offerDesc);

      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);

      sdpTextarea.value = JSON.stringify(pc.localDescription);
    };

    sdpTextarea.onchange = async () => {
      if (!pc) return;
      try {
        const desc = JSON.parse(sdpTextarea.value);
        await pc.setRemoteDescription(desc);
      } catch (e) {
        console.error('Invalid SDP JSON', e);
      }
    };
  </script>
</body>

</html>